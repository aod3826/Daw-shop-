<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏á‡∏î‡∏≤‡∏ß - ‡∏ô‡πâ‡∏≥‡∏õ‡∏±‡πà‡∏ô ‡∏¢‡∏≥ ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏õ‡∏¥‡πâ‡∏á</title>
  
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- FontAwesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
  
  <!-- Google Font - Prompt -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- SweetAlert2 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.7.32/sweetalert2.min.css" rel="stylesheet">
  
  <style>
    * {
      font-family: 'Prompt', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      padding-bottom: 100px;
      margin: 0;
    }

    /* ========== ‡πÅ‡∏ñ‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡∏¥‡πà‡∏á ========== */
    .marquee-container {
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 8px 0;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .marquee-content {
      display: inline-block;
      white-space: nowrap;
      animation: marquee 20s linear infinite;
      font-size: 0.95rem;
      font-weight: 500;
    }

    @keyframes marquee {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    .marquee-container.closed {
      background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
    }

    /* ========== Header ========== */
    .header {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 1.2rem 1rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 0.8rem 0;
    }

    .search-box {
      position: relative;
    }

    .search-box i {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #6b7280;
    }

    .search-box input {
      padding-left: 40px;
      border-radius: 25px;
      border: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .cart-btn {
      position: relative;
      background: white;
      color: #10b981;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: all 0.3s;
    }

    .cart-btn:hover {
      transform: scale(1.1);
    }

    .cart-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
    }

    /* ========== ETA Banner ========== */
    .eta-banner {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: white;
      padding: 1rem;
      margin: 1rem;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    /* ========== Categories ========== */
    .categories-section {
      background: white;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow-x: auto;
      white-space: nowrap;
    }

    .category-pill {
      display: inline-block;
      padding: 0.6rem 1.5rem;
      margin: 0 0.3rem;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
      border: 2px solid transparent;
    }

    .category-pill:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .category-pill.active {
      transform: scale(1.05);
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
      border-color: rgba(255,255,255,0.3);
    }

    /* ========== Menu Cards ========== */
    .menu-grid {
      padding: 1rem;
    }

    .menu-card {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 1rem;
      position: relative;
    }

    .menu-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.2);
    }

    .menu-icon {
      height: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 4rem;
      position: relative;
    }

    .badge-today {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ef4444;
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.7rem;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
    }

    .menu-body {
      padding: 1rem;
    }

    .menu-name {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.5rem;
      color: #1f2937;
    }

    .menu-price {
      color: #10b981;
      font-weight: 700;
      font-size: 1.2rem;
    }

    /* ========== Options Modal ========== */
    .option-item {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 0.8rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .option-item:hover {
      background: #f9fafb;
      border-color: #10b981;
    }

    .option-item.selected {
      border-color: #10b981;
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
    }

    .option-check {
      color: #10b981;
      font-size: 1.2rem;
    }

    /* ========== Cart ========== */
    .cart-item {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 0.8rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .qty-control {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .qty-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .qty-btn:hover {
      transform: scale(1.1);
    }

    /* ========== Checkout ========== */
    .checkout-section {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .payment-option {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 0.8rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .payment-option:hover {
      border-color: #10b981;
      background: #f9fafb;
    }

    .payment-option.selected {
      border-color: #10b981;
      background: #d1fae5;
    }

    .payment-icon {
      font-size: 2rem;
    }

    /* ========== Summary ========== */
    .summary-box {
      background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      border-radius: 12px;
      padding: 1.2rem;
      margin-bottom: 1rem;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .summary-total {
      border-top: 2px solid #10b981;
      padding-top: 0.8rem;
      margin-top: 0.8rem;
      font-size: 1.2rem;
      font-weight: 700;
    }

    /* ========== Buttons ========== */
    .btn-primary-custom {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border: none;
      color: white;
      padding: 1rem 2rem;
      border-radius: 25px;
      font-weight: 600;
      font-size: 1.1rem;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      transition: all 0.3s;
    }

    .btn-primary-custom:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
    }

    /* ========== Loading ========== */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
    }

    .spinner {
      border: 4px solid #f3f4f6;
      border-top: 4px solid #10b981;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ========== Responsive ========== */
    @media (max-width: 576px) {
      .header h1 {
        font-size: 1.3rem;
      }
      .menu-icon {
        height: 120px;
        font-size: 3rem;
      }
    }
  </style>
</head>
<body>

  <!-- ‡πÅ‡∏ñ‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡∏¥‡πà‡∏á -->
  <div class="marquee-container" id="marqueeBar">
    <div class="marquee-content" id="marqueeText">
      <i class="fas fa-calendar-day"></i> <span id="currentDate"></span> | 
      <span id="statusMessage"></span>
    </div>
  </div>

  <!-- App Container -->
  <div id="app">
    <div class="loading-container">
      <div class="spinner"></div>
      <p class="mt-3 text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
  
  <!-- SweetAlert2 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.7.32/sweetalert2.all.min.js"></script>

  <script>
    // ========================================
    // Configuration
    // ========================================
    // ========================================
// Configuration
// ========================================
const CONFIG = {
  GAS_URL: '...‡∏•‡∏¥‡∏á‡∏Å‡πå Web App URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...', 
  USE_MOCK_DATA: false,
  LIFF_ID: '2008933274-cQhoTxw9' // üëà ‡πÄ‡∏≠‡∏≤‡πÄ‡∏•‡∏Ç ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ!
};

    // ========================================
    // Mock Data
    // ========================================
    const MOCK_DATA = {
      categories: [
        { CategoryID: 'C1', CategoryName: '‡∏ô‡πâ‡∏≥‡∏õ‡∏±‡πà‡∏ô', Sort: 1, Active: true, color: '#10b981', icon: 'ü•§' },
        { CategoryID: 'C2', CategoryName: '‡∏¢‡∏≥', Sort: 2, Active: true, color: '#ef4444', icon: 'ü•ó' },
        { CategoryID: 'C3', CategoryName: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏õ‡∏¥‡πâ‡∏á', Sort: 3, Active: true, color: '#f59e0b', icon: 'üçû' }
      ],
      menus: [
        { MenuID: 'M1', CategoryID: 'C1', MenuName: '‡∏ô‡πâ‡∏≥‡∏õ‡∏±‡πà‡∏ô‡∏™‡∏ï‡∏£‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà', BasePrice: 45, Available: true, TodayFlag: true, PrepTime: 5 },
        { MenuID: 'M2', CategoryID: 'C1', MenuName: '‡∏ô‡πâ‡∏≥‡∏õ‡∏±‡πà‡∏ô‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á', BasePrice: 50, Available: true, TodayFlag: true, PrepTime: 5 },
        { MenuID: 'M3', CategoryID: 'C1', MenuName: '‡∏ô‡πâ‡∏≥‡∏õ‡∏±‡πà‡∏ô‡∏Å‡∏•‡πâ‡∏ß‡∏¢', BasePrice: 40, Available: true, TodayFlag: false, PrepTime: 5 },
        { MenuID: 'M4', CategoryID: 'C2', MenuName: '‡∏¢‡∏≥‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô', BasePrice: 60, Available: true, TodayFlag: true, PrepTime: 10 },
        { MenuID: 'M5', CategoryID: 'C2', MenuName: '‡∏¢‡∏≥‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß', BasePrice: 55, Available: true, TodayFlag: true, PrepTime: 10 },
        { MenuID: 'M6', CategoryID: 'C2', MenuName: '‡∏¢‡∏≥‡∏ñ‡∏±‡πà‡∏ß‡∏û‡∏π', BasePrice: 50, Available: true, TodayFlag: false, PrepTime: 10 },
        { MenuID: 'M7', CategoryID: 'C3', MenuName: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏ô‡∏°‡∏™‡∏î', BasePrice: 35, Available: true, TodayFlag: true, PrepTime: 7 },
        { MenuID: 'M8', CategoryID: 'C3', MenuName: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï', BasePrice: 40, Available: true, TodayFlag: true, PrepTime: 7 }
      ],
      optionGroups: [
        {
          GroupID: 'G1',
          GroupName: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô',
          Required: true,
          MultiSelect: false,
          Options: [
            { OptionID: 'O1', Label: '‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢', Price: 0 },
            { OptionID: 'O2', Label: '‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', Price: 0 },
            { OptionID: 'O3', Label: '‡∏´‡∏ß‡∏≤‡∏ô‡∏°‡∏≤‡∏Å', Price: 0 }
          ]
        },
        {
          GroupID: 'G2',
          GroupName: '‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°',
          Required: false,
          MultiSelect: true,
          Options: [
            { OptionID: 'O4', Label: '‡∏ß‡∏¥‡∏õ‡∏Ñ‡∏£‡∏µ‡∏°', Price: 10 },
            { OptionID: 'O5', Label: '‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å', Price: 15 },
            { OptionID: 'O6', Label: '‡∏ß‡∏∏‡πâ‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü', Price: 10 }
          ]
        }
      ],
      systemConfig: {
        SHOP_OPEN: true,
        MAX_QUEUE: 20,
        SHOP_NAME: '‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏á‡∏î‡∏≤‡∏ß',
        DELIVERY_FEE: 50,
        FREE_DELIVERY_MIN: 500
      }
    };

    // ========================================
    // Global State
    // ========================================
    const state = {
      categories: [],
      menus: [],
      optionGroups: [],
      systemConfig: {},
      cart: [],
      selectedCategory: 'ALL',
      searchTerm: '',
      currentQueue: 0,
      shopOpen: true
    };

    // ========================================
    // Utility Functions
    // ========================================
    function getThaiDate() {
      const days = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
      const months = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                      '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
      const now = new Date();
      const day = days[now.getDay()];
      const date = now.getDate();
      const month = months[now.getMonth()];
      return `‡∏ß‡∏±‡∏ô${day}‡∏ó‡∏µ‡πà ${date} ${month}`;
    }

    function updateMarquee() {
      const dateEl = document.getElementById('currentDate');
      const statusEl = document.getElementById('statusMessage');
      const marqueeBar = document.getElementById('marqueeBar');

      dateEl.textContent = getThaiDate();

      if (state.shopOpen) {
        statusEl.innerHTML = '<i class="fas fa-store"></i> ‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏á‡∏î‡∏≤‡∏ß‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞ ‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ üòã';
        marqueeBar.classList.remove('closed');
      } else {
        statusEl.innerHTML = '<i class="fas fa-store-slash"></i> ‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏∞ üôè';
        marqueeBar.classList.add('closed');
      }
    }

    // ========================================
    // Data Loading
    // ========================================
    async function loadData() {
      try {
        if (CONFIG.USE_MOCK_DATA) {
          state.categories = MOCK_DATA.categories;
          state.menus = MOCK_DATA.menus;
          state.optionGroups = MOCK_DATA.optionGroups;
          state.systemConfig = MOCK_DATA.systemConfig;
          state.shopOpen = MOCK_DATA.systemConfig.SHOP_OPEN;
        } else {
          const response = await fetch(`${CONFIG.GAS_URL}?action=getMenu`);
          const data = await response.json();
          // Process data...
        }
        
        updateMarquee();
        render();
      } catch (error) {
        console.error('Load Data Error:', error);
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á'
        });
      }
    }

    // ========================================
    // Render Functions
    // ========================================
    function render() {
      const filteredMenus = state.menus.filter(menu => {
        const matchCategory = state.selectedCategory === 'ALL' || menu.CategoryID === state.selectedCategory;
        const matchSearch = menu.MenuName.toLowerCase().includes(state.searchTerm.toLowerCase());
        return matchCategory && matchSearch && menu.Available;
      });

      const categoryColors = {
        'C1': '#10b981',
        'C2': '#ef4444',
        'C3': '#f59e0b'
      };

      const categoryIcons = {
        'C1': 'ü•§',
        'C2': 'ü•ó',
        'C3': 'üçû'
      };

      const html = `
        <!-- Header -->
        <div class="header">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <h1><i class="fas fa-utensils"></i> ${state.systemConfig.SHOP_NAME || '‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏á‡∏î‡∏≤‡∏ß'}</h1>
            <div class="cart-btn" onclick="openCart()">
              <i class="fas fa-shopping-cart fa-lg"></i>
              ${state.cart.length > 0 ? `<span class="cart-badge">${state.cart.length}</span>` : ''}
            </div>
          </div>
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input 
              type="text" 
              class="form-control" 
              placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π..."
              id="searchInput"
              value="${state.searchTerm}"
            >
          </div>
        </div>

        <!-- ETA Banner -->
        ${state.currentQueue > 0 ? `
          <div class="eta-banner">
            <div class="d-flex align-items-center">
              <i class="fas fa-clock fa-2x me-3"></i>
              <div>
                <div class="fw-bold fs-5">‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: #${state.currentQueue}</div>
                <small>‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: ${state.currentQueue * 5} ‡∏ô‡∏≤‡∏ó‡∏µ</small>
              </div>
            </div>
          </div>
        ` : ''}

        <!-- Categories -->
        <div class="categories-section">
          <span 
            class="category-pill ${state.selectedCategory === 'ALL' ? 'active' : ''}"
            style="background: ${state.selectedCategory === 'ALL' ? '#1f2937' : '#e5e7eb'}; 
                   color: ${state.selectedCategory === 'ALL' ? 'white' : '#000'};"
            onclick="selectCategory('ALL')"
          >
            <i class="fas fa-th-large"></i> ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          </span>
          ${state.categories.map(cat => `
            <span 
              class="category-pill ${state.selectedCategory === cat.CategoryID ? 'active' : ''}"
              style="background: ${state.selectedCategory === cat.CategoryID ? cat.color : '#e5e7eb'}; 
                     color: ${state.selectedCategory === cat.CategoryID ? 'white' : '#000'};"
              onclick="selectCategory('${cat.CategoryID}')"
            >
              ${cat.icon} ${cat.CategoryName}
            </span>
          `).join('')}
        </div>

        <!-- Menu Grid -->
        <div class="menu-grid">
          <div class="row g-3">
            ${filteredMenus.length === 0 ? `
              <div class="col-12 text-center py-5">
                <i class="fas fa-search fa-3x text-muted mb-3"></i>
                <p class="text-muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
              </div>
            ` : filteredMenus.map(menu => {
              const cat = state.categories.find(c => c.CategoryID === menu.CategoryID);
              return `
                <div class="col-6 col-md-4 col-lg-3">
                  <div class="menu-card" onclick='openMenuOptions(${JSON.stringify(menu)})'>
                    ${menu.TodayFlag ? '<span class="badge-today"><i class="fas fa-star"></i> ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>' : ''}
                    <div class="menu-icon" style="background: ${cat?.color}; color: white;">
                      ${cat?.icon || 'üçΩÔ∏è'}
                    </div>
                    <div class="menu-body">
                      <div class="menu-name">${menu.MenuName}</div>
                      <div class="menu-price">${menu.BasePrice} ‡∏ø</div>
                    </div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;

      document.getElementById('app').innerHTML = html;

      // Add search event listener
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => {
          state.searchTerm = e.target.value;
          render();
        });
      }
    }

    // ========================================
    // Category Selection
    // ========================================
    function selectCategory(categoryId) {
      state.selectedCategory = categoryId;
      render();
    }

    // ========================================
    // Menu Options Modal
    // ========================================
    let selectedOptions = {};

    function openMenuOptions(menu) {
      if (!state.shopOpen) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞',
          text: '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡πà‡∏∞'
        });
        return;
      }

      selectedOptions = {};

      const optionGroupsHtml = state.optionGroups.map((group, gIdx) => `
        <div class="mb-4">
          <h6 class="fw-bold mb-3">
            <i class="fas fa-cog"></i> ${group.GroupName}
            ${group.Required ? '<span class="text-danger">*</span>' : ''}
            ${group.MultiSelect ? '<small class="text-muted ms-2">(‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á)</small>' : ''}
          </h6>
          ${group.Options.map((opt, oIdx) => `
            <div 
              class="option-item" 
              id="opt-${gIdx}-${oIdx}"
              onclick="selectOption(${gIdx}, ${oIdx}, ${group.MultiSelect})"
            >
              <div class="d-flex justify-content-between align-items-center">
                <span><i class="fas fa-check-circle option-check" id="check-${gIdx}-${oIdx}" style="display: none;"></i> ${opt.Label}</span>
                ${opt.Price > 0 ? `<span class="text-success fw-bold">+${opt.Price} ‡∏ø</span>` : ''}
              </div>
            </div>
          `).join('')}
        </div>
      `).join('');

      Swal.fire({
        title: `<i class="fas fa-shopping-bag"></i> ${menu.MenuName}`,
        html: `
          <div class="text-start">
            <p class="text-success fw-bold fs-5 mb-4">${menu.BasePrice} ‡∏ø</p>
            ${optionGroupsHtml}
          </div>
        `,
        width: '90%',
        showCancelButton: true,
        confirmButtonText: '<i class="fas fa-cart-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        confirmButtonColor: '#10b981',
        didOpen: () => {
          window.currentMenu = menu;
        },
        preConfirm: () => {
          return addToCart();
        }
      });
    }

    function selectOption(groupIdx, optIdx, multiSelect) {
      if (!selectedOptions[groupIdx]) {
        selectedOptions[groupIdx] = [];
      }

      const group = state.optionGroups[groupIdx];
      const optElement = document.getElementById(`opt-${groupIdx}-${optIdx}`);
      const checkElement = document.getElementById(`check-${groupIdx}-${optIdx}`);

      // Logic ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (Single vs Multi)
      if (multiSelect) {
        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏Å‡∏î‡∏ã‡πâ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        const index = selectedOptions[groupIdx].findIndex(idx => idx === optIdx);
        if (index > -1) {
          selectedOptions[groupIdx].splice(index, 1); // ‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å
          optElement.classList.remove('selected');
          checkElement.style.display = 'none';
        } else {
          selectedOptions[groupIdx].push(optIdx); // ‡πÉ‡∏™‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°
          optElement.classList.add('selected');
          checkElement.style.display = 'block';
        }
      } else {
        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß: ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô
        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï UI ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
        state.optionGroups[groupIdx].Options.forEach((_, idx) => {
          const el = document.getElementById(`opt-${groupIdx}-${idx}`);
          const chk = document.getElementById(`check-${groupIdx}-${idx}`);
          if (el) el.classList.remove('selected');
          if (chk) chk.style.display = 'none';
        });

        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà
        selectedOptions[groupIdx] = [optIdx];
        optElement.classList.add('selected');
        checkElement.style.display = 'block';
      }
    }

    function addToCart() {
      const menu = window.currentMenu;
      const options = [];
      let totalOptionPrice = 0;

      // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Required Groups
      for (let gIdx = 0; gIdx < state.optionGroups.length; gIdx++) {
        const group = state.optionGroups[gIdx];
        const selectedInGroup = selectedOptions[gIdx] || [];

        if (group.Required && selectedInGroup.length === 0) {
          Swal.showValidationMessage(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "${group.GroupName}"`);
          return false;
        }

        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Options ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        selectedInGroup.forEach(optIdx => {
          const opt = group.Options[optIdx];
          options.push(opt);
          totalOptionPrice += opt.Price;
        });
      }

      // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Item ‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
      const cartItem = {
        ...menu,
        options: options,
        totalPrice: menu.BasePrice + totalOptionPrice,
        qty: 1
      };

      state.cart.push(cartItem);
      
      // 3. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
      render();
      
      Swal.fire({
        icon: 'success',
        title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß',
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 1500
      });
    }

    // ========================================
    // Cart & Checkout Logic
    // ========================================
    function openCart() {
      if (state.cart.length === 0) {
        Swal.fire({
          icon: 'info',
          title: '‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö'
        });
        return;
      }

      updateCartModal();
    }

    function updateCartModal() {
      const { subtotal, deliveryFee, total } = calculateTotal();
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
      const cartItemsHtml = state.cart.map((item, idx) => `
        <div class="cart-item">
          <div class="d-flex justify-content-between mb-2">
            <span class="fw-bold">${item.MenuName}</span>
            <span class="fw-bold text-success">${(item.totalPrice * item.qty).toLocaleString()} ‡∏ø</span>
          </div>
          <div class="small text-muted mb-2">
            ${item.options.map(opt => `+ ${opt.Label}`).join(', ')}
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <div class="qty-control">
              <button class="qty-btn bg-light" onclick="updateQty(${idx}, -1)"><i class="fas fa-minus"></i></button>
              <span class="fw-bold">${item.qty}</span>
              <button class="qty-btn btn-success text-white" onclick="updateQty(${idx}, 1)"><i class="fas fa-plus"></i></button>
            </div>
            <button class="btn btn-sm text-danger" onclick="removeFromCart(${idx})"><i class="fas fa-trash"></i></button>
          </div>
        </div>
      `).join('');

      Swal.fire({
        title: '<i class="fas fa-shopping-cart"></i> ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô',
        html: `
          <div class="text-start bg-light p-3 rounded mb-3" style="max-height: 40vh; overflow-y: auto;">
            ${cartItemsHtml}
          </div>
          
          <div class="summary-box">
            <div class="summary-row">
              <span>‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
              <span>${subtotal.toLocaleString()} ‡∏ø</span>
            </div>
            <div class="summary-row text-danger" id="deliveryRow" style="display: none;">
              <span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
              <span>${deliveryFee} ‡∏ø</span>
            </div>
            <div class="summary-total d-flex justify-content-between">
              <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</span>
              <span id="totalDisplay">${subtotal.toLocaleString()} ‡∏ø</span>
            </div>
          </div>

          <div class="d-grid gap-2">
            <button class="btn btn-primary-custom" onclick="openCheckout()">
              ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        `,
        showConfirmButton: false,
        showCloseButton: true,
        width: '95%'
      });
    }

    function updateQty(idx, delta) {
      const newQty = state.cart[idx].qty + delta;
      if (newQty > 0) {
        state.cart[idx].qty = newQty;
        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä Modal ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        updateCartModal(); 
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Badge ‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        render(); 
      }
    }

    function removeFromCart(idx) {
      state.cart.splice(idx, 1);
      if (state.cart.length === 0) {
        Swal.close();
      } else {
        updateCartModal();
      }
      render();
    }

    function calculateTotal() {
      const subtotal = state.cart.reduce((sum, item) => sum + (item.totalPrice * item.qty), 0);
      // ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô 0 (‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Delivery)
      return { subtotal, deliveryFee: 0, total: subtotal };
    }

    // ========================================
    // Checkout Process
    // ========================================
    let checkoutState = {
      deliveryType: 'pickup', // pickup, delivery
      paymentType: 'cash',    // cash, qr, credit
      address: '',
      slipFile: null
    };

    function openCheckout() {
      const { subtotal } = calculateTotal();
      const freeDeliveryMin = state.systemConfig.FREE_DELIVERY_MIN || 500;
      const deliveryFeeConfig = state.systemConfig.DELIVERY_FEE || 50;
      
      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏° Logic
      let deliveryFee = 0;
      if (checkoutState.deliveryType === 'delivery') {
        deliveryFee = subtotal >= freeDeliveryMin ? 0 : deliveryFeeConfig;
      }
      const finalTotal = subtotal + deliveryFee;

      Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠',
        html: `
          <div class="text-start">
            <h6 class="fw-bold mb-3"><i class="fas fa-truck"></i> ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h6>
            <div class="row g-2 mb-3">
              <div class="col-6">
                <div class="payment-option ${checkoutState.deliveryType === 'pickup' ? 'selected' : ''}" 
                     onclick="setDeliveryType('pickup')">
                  <i class="fas fa-store text-success"></i> ‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á
                </div>
              </div>
              <div class="col-6">
                <div class="payment-option ${checkoutState.deliveryType === 'delivery' ? 'selected' : ''}" 
                     onclick="setDeliveryType('delivery')">
                  <i class="fas fa-motorcycle text-warning"></i> ‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà
                </div>
              </div>
            </div>

            <div id="addressSection" class="mb-3" style="display: ${checkoutState.deliveryType === 'delivery' ? 'block' : 'none'};">
              <label class="small text-muted">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</label>
              <textarea id="addressInput" class="form-control" rows="2" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ã‡∏≠‡∏¢, ‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï...">${checkoutState.address}</textarea>
            </div>

            <hr>

            <h6 class="fw-bold mb-3"><i class="fas fa-wallet"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h6>
            
            <div class="payment-option ${checkoutState.paymentType === 'cash' ? 'selected' : ''}" 
                 onclick="setPaymentType('cash')">
              <i class="fas fa-money-bill-wave text-success fs-4 me-3"></i>
              <div>
                <div class="fw-bold">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</div>
                <small class="text-muted">‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</small>
              </div>
            </div>

            <div class="payment-option ${checkoutState.paymentType === 'qr' ? 'selected' : ''}" 
                 onclick="setPaymentType('qr')">
              <i class="fas fa-qrcode text-primary fs-4 me-3"></i>
              <div>
                <div class="fw-bold">‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢</div>
                <small class="text-muted">PromptPay / ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ</small>
              </div>
            </div>

            <div class="payment-option ${checkoutState.paymentType === 'credit' ? 'selected' : ''}" 
                 onclick="setPaymentType('credit')">
              <i class="fas fa-user-clock text-info fs-4 me-3"></i>
              <div>
                <div class="fw-bold">‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡πà‡∏≤‡∏¢ (‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å)</div>
                <small class="text-muted">‡∏•‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô</small>
              </div>
            </div>

            <div id="qrSection" class="mt-3 bg-light p-3 rounded text-center" style="display: ${checkoutState.paymentType === 'qr' ? 'block' : 'none'};">
              <img src="https://promptpay.io/${state.systemConfig.PROMPTPAY_ID || '0812345678'}/${finalTotal}.png" class="img-fluid mb-2" style="max-width: 150px;">
              <p class="small text-muted">‡∏¢‡∏≠‡∏î‡πÇ‡∏≠‡∏ô: <b class="text-success">${finalTotal} ‡∏ø</b></p>
              <input type="file" id="slipInput" class="form-control" accept="image/*" onchange="handleSlip(this)">
              <div id="slipPreview" class="mt-2 text-success small"></div>
            </div>

            <hr>

            <div class="d-flex justify-content-between fw-bold fs-5">
              <span>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
              <span class="text-success">${finalTotal.toLocaleString()} ‡∏ø</span>
            </div>
            ${deliveryFee === 0 && checkoutState.deliveryType === 'delivery' ? '<small class="text-success d-block text-end">‡∏ü‡∏£‡∏µ‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á!</small>' : ''}
          </div>
        `,
        width: '95%',
        showCancelButton: true,
        confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠',
        cancelButtonText: '‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö',
        confirmButtonColor: '#10b981',
        preConfirm: () => {
          // Validation
          if (checkoutState.deliveryType === 'delivery') {
            const addr = document.getElementById('addressInput').value;
            if (!addr) return Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á');
            checkoutState.address = addr;
          }
          if (checkoutState.paymentType === 'qr' && !checkoutState.slipFile) {
            return Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô');
          }
          return submitOrder(finalTotal);
        }
      });
    }

    // Helper functions for Checkout UI
    function setDeliveryType(type) {
      checkoutState.deliveryType = type;
      openCheckout(); // Re-render
    }

    function setPaymentType(type) {
      checkoutState.paymentType = type;
      openCheckout(); // Re-render
    }

    function handleSlip(input) {
      if (input.files && input.files[0]) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          checkoutState.slipFile = e.target.result; // Base64 string
          document.getElementById('slipPreview').innerHTML = `<i class="fas fa-check"></i> ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß (${file.name})`;
        };
        reader.readAsDataURL(file);
      }
    }

    // ========================================
    // Submit Order API
    // ========================================
    async function submitOrder(finalTotal) {
      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå...',
        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      try {
        const orderData = {
          action: 'createOrder',
          items: state.cart,
          deliveryType: checkoutState.deliveryType,
          paymentType: checkoutState.paymentType,
          address: checkoutState.address,
          total: finalTotal,
          slipURL: checkoutState.slipFile, // Send Base64 directly (Backend handles it)
          userId: 'U' + Date.now() // Mock UserID (In real LIFF, use liff.getProfile())
        };

        let result;
        if (CONFIG.USE_MOCK_DATA) {
          // Simulator
          await new Promise(r => setTimeout(r, 1500));
          result = { success: true, orderID: 'ORD-MOCK', queueNumber: state.currentQueue + 1, eta: 15 };
        } else {
          // Real API Call
          const response = await fetch(CONFIG.GAS_URL, {
            method: 'POST',
            body: JSON.stringify(orderData)
          });
          result = await response.json();
        }

        if (result.success) {
          state.cart = []; // Clear Cart
          state.currentQueue = result.queueNumber; // Update Queue
          render();
          
          Swal.fire({
            icon: 'success',
            title: '‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
            html: `
              <h3>‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <span class="text-danger">#${result.queueNumber}</span></h3>
              <p>‡∏≠‡∏µ‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${result.eta} ‡∏ô‡∏≤‡∏ó‡∏µ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡∏ö</p>
            `,
            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
          });
        } else {
          throw new Error(result.error || 'Unknown error');
        }

      } catch (error) {
        console.error(error);
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ: ' + error.message
        });
      }
    }

    // ========================================
    // Initialize App
    // ========================================
    document.addEventListener('DOMContentLoaded', () => {
      loadData();
    });

  </script>
</body>
</html>
